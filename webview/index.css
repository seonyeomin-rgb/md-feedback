@tailwind base;
@tailwind components;
@tailwind utilities;

/* Nuclear override: VS Code dark theme — in @layer base so Tailwind doesn't reorder */
@layer base {
  html, body,
  .vscode-dark, .vscode-light, .vscode-high-contrast {
    background: #fafaf9 !important;
    color: #1a1a1a !important;
  }
}

/* ── VS Code-aware root ── */
.md-feedback-root {
  font-family: var(--vscode-font-family, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif);
  /* Force paper theme */
  --vscode-editor-background: #fafaf9;
  --vscode-editor-foreground: #1a1a1a;
  background: #fafaf9 !important;
  color: #1a1a1a !important;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.content-area {
  flex: 1;
  position: relative;
}

/* ── Base typography ── */
.tiptap-editor {
  color: #1a1a1a;
  font-size: 16px;
  line-height: 1.8;
}

.tiptap-editor:focus { outline: none; }
.tiptap-editor > * + * { margin-top: 0.5em; }

/* ── Read-only ── */
.tiptap-readonly {
  cursor: default;
  caret-color: transparent;
}
.tiptap-readonly *::selection {
  background: #dbeafe; /* WCAG AA selection */
}

/* ── Headings ── */
.tiptap-editor h1 { @apply text-[30px] font-bold mt-10 mb-3 leading-tight tracking-[-0.02em]; }
.tiptap-editor h2 { @apply text-[22px] font-semibold mt-8 mb-2.5 pb-2 border-b border-stone-100 leading-snug; }
.tiptap-editor h3 { @apply text-[18px] font-semibold mt-6 mb-2; }
.tiptap-editor h4 { @apply text-[16px] font-medium mt-4 mb-1.5; }

/* ── Body ── */
.tiptap-editor p { @apply my-2; }
.tiptap-editor ul { @apply list-disc pl-6 my-2.5 space-y-0.5; }
.tiptap-editor ol { @apply list-decimal pl-6 my-2.5 space-y-0.5; }
.tiptap-editor li { line-height: 1.8; }
.tiptap-editor li > p { @apply my-0; }
.tiptap-editor blockquote { @apply border-l-[3px] border-stone-200 pl-4 text-stone-500 my-4; }

/* ── Code ── */
.tiptap-editor code {
  @apply px-1.5 py-0.5 rounded text-[0.88em] font-mono;
  color: #d4372c; /* WCAG AA inline code */
  background: rgba(135, 131, 120, 0.08);
}
.tiptap-editor pre {
  @apply my-4 overflow-x-auto rounded-md;
  background: #f5f5f5;
  border: 1px solid rgba(0, 0, 0, 0.06);
  padding: 16px 20px;
  color: #1a1a1a !important;
}
.tiptap-editor pre code {
  @apply p-0 text-[13px] leading-relaxed;
  background: transparent;
  color: inherit;
  font-family: var(--vscode-editor-font-family, 'JetBrains Mono', 'SFMono-Regular', Menlo, Consolas, monospace);
}

/* ── Table ── */
.tiptap-editor table { @apply w-full border-collapse my-4; }
.tiptap-editor th { @apply bg-stone-50 border border-stone-200 px-3 py-2 text-left text-[14px] font-medium text-stone-600; }
.tiptap-editor td { @apply border border-stone-100 px-3 py-2 text-[14px]; }
.tiptap-editor hr { @apply border-stone-100 my-8; }
.tiptap-editor a { 
  color: #2563eb; /* WCAG AA link */
  text-decoration: underline;
  text-decoration-color: #bfdbfe;
  transition: text-decoration-color 0.2s;
}
.tiptap-editor a:hover { text-decoration-color: #2563eb; }
.tiptap-editor strong { @apply font-semibold; }
.tiptap-editor em { @apply italic; }

/* ═══════════════════════════════════════════
   Annotations — real pen-on-paper feel
   ═══════════════════════════════════════════ */

/* Yellow = HIGHLIGHT — real marker pen */
.tiptap-editor mark[data-color="#fef08a"],
.tiptap-editor mark:not([data-color]) {
  background: none;
  border-radius: 0;
  padding: 2px 0;
  background-image: linear-gradient(
    104deg,
    rgba(250, 204, 21, 0) 0.9%,
    rgba(250, 204, 21, 0.42) 2.4%,
    rgba(250, 204, 21, 0.32) 5.8%,
    rgba(250, 204, 21, 0.32) 93%,
    rgba(250, 204, 21, 0.42) 96%,
    rgba(250, 204, 21, 0) 98%
  );
  -webkit-box-decoration-break: clone;
  box-decoration-break: clone;
}

/* Red = FIX — strikethrough */
.tiptap-editor mark[data-color="#fca5a5"] {
  background: none;
  padding: 0;
  text-decoration: line-through;
  text-decoration-color: #dc2626;
  text-decoration-thickness: 2px;
  text-decoration-skip-ink: none;
  -webkit-box-decoration-break: clone;
  box-decoration-break: clone;
}

/* Blue = QUESTION — wavy underline */
.tiptap-editor mark[data-color="#93c5fd"] {
  background: none;
  padding: 0;
  text-decoration: underline wavy;
  text-decoration-color: #3b82f6;
  text-decoration-thickness: 1.5px;
  text-underline-offset: 4px;
  -webkit-box-decoration-break: clone;
  box-decoration-break: clone;
}

/* ── Placeholder ── */
.tiptap-editor p.is-editor-empty:first-child::before {
  @apply text-stone-300 text-base;
  content: attr(data-placeholder);
  float: left;
  height: 0;
  pointer-events: none;
}

/* ── Task list ── */
.tiptap-editor ul[data-type="taskList"] { @apply list-none pl-0; }
.tiptap-editor ul[data-type="taskList"] li { @apply flex items-start gap-2; }
.tiptap-editor ul[data-type="taskList"] li > label { @apply mt-1; }
.tiptap-editor ul[data-type="taskList"] li > label input[type="checkbox"] { @apply w-4 h-4 rounded border-stone-300 accent-stone-600; }
.tiptap-editor ul[data-type="taskList"] li > div { @apply flex-1; }

/* ── Image ── */
.tiptap-editor img { @apply max-w-full h-auto rounded my-4; }

/* ── Page layout ── */
.paper-container {
  @apply flex justify-center py-6 px-4;
  min-height: 100%;
}
.paper {
  background: white !important;
  max-width: 820px;
  width: 100%;
  padding: 48px 56px 72px;
  min-height: 90vh;
}
@media (max-width: 768px) {
  .paper { padding: 28px 20px 48px; }
}

/* ── Memo card ── */
.memo-card {
  background: white !important;
  border: 1px solid rgba(0, 0, 0, 0.04);
  border-left: 3px solid var(--memo-accent, #dc2626);
  border-radius: 0 6px 6px 0;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
  max-width: 26rem;
  transition: box-shadow 0.15s ease;
  animation: memo-enter 0.2s ease-out;
}
.memo-card:hover { box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05); }

@keyframes memo-enter {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ── Bubble menu ── */
.bubble-menu-glass {
  background: white !important;
  border: 1px solid rgba(0, 0, 0, 0.08);
  border-radius: 12px;
  box-shadow:
    0 4px 16px rgba(0, 0, 0, 0.1),
    0 1px 3px rgba(0, 0, 0, 0.06);
  padding: 6px 4px;
}

.bubble-btn {
  @apply flex flex-col items-center gap-0.5 px-3.5 py-2 rounded-lg transition-colors cursor-pointer;
}
.bubble-btn:hover {
  @apply bg-stone-50;
}
.bubble-btn:active {
  @apply bg-stone-100;
}

.bubble-btn-primary {
  @apply flex flex-col items-center gap-0.5 px-5 py-2 rounded-lg transition-colors cursor-pointer;
  background: rgba(251, 191, 36, 0.06);
}
.bubble-btn-primary:hover {
  background: rgba(251, 191, 36, 0.14);
}
.bubble-btn-primary:active {
  background: rgba(251, 191, 36, 0.22);
}

.bubble-icon {
  @apply flex items-center justify-center w-7 h-7;
}

.bubble-label {
  @apply text-[11px] font-medium leading-none;
}

.bubble-kbd {
  @apply text-[9px] text-stone-300 font-mono leading-none mt-0.5;
}

.bubble-sep {
  @apply w-px h-8 bg-stone-100 mx-0.5;
}

/* ── Delete mark popover ── */
.delete-popover {
  z-index: 50;
  transform: translateX(-50%);
  animation: memo-enter 0.1s ease-out;
}
.delete-popover-btn {
  @apply text-[12px] font-medium text-rose-500 hover:text-rose-600 px-3 py-1.5 rounded-lg cursor-pointer;
  background: white !important;
  border: 1px solid rgba(0, 0, 0, 0.08);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* ── Scrollbar ── */
::-webkit-scrollbar { width: 5px; }
::-webkit-scrollbar-track { @apply bg-transparent; }
::-webkit-scrollbar-thumb { @apply bg-stone-200 rounded-full; }
::-webkit-scrollbar-thumb:hover { @apply bg-stone-300; }

/* ── Status Summary Bar ── */
.status-bar {
  position: sticky;
  bottom: 52px; /* above floating bar */
  background: rgba(250, 250, 249, 0.95);
  backdrop-filter: blur(4px);
  border-top: 1px solid rgba(0, 0, 0, 0.04);
  padding: 6px 16px;
  display: flex;
  align-items: center;
  gap: 16px;
  z-index: 29;
  font-size: 12px;
}

.status-items {
  display: flex;
  align-items: center;
  gap: 12px;
}

.cursor-info {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-left: auto;
  font-size: 11px;
}

/* ── Floating Bar ── */
.floating-bar {
  position: sticky;
  bottom: 0;
  background: #fafaf9;
  border-top: 1px solid rgba(0, 0, 0, 0.06);
  padding: 10px 16px;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 8px;
  z-index: 30;
}

.floating-btn {
  @apply flex flex-col items-center gap-0.5 px-3 py-1.5 rounded-lg transition-all cursor-pointer hover:bg-stone-100 active:bg-stone-200;
  color: #57534e;
}

/* ── Onboarding Banner ── */
.onboarding-banner {
  @apply bg-white border-b border-stone-100 px-4 py-3 flex items-center justify-between;
  animation: memo-enter 0.3s ease-out;
}

.onboarding-content {
  @apply flex items-center gap-3;
}

.onboarding-emoji {
  @apply text-xl;
}

.onboarding-banner p {
  @apply text-[13px] font-medium text-stone-600;
}

.onboarding-close {
  @apply p-1.5 text-stone-400 hover:text-stone-600 hover:bg-stone-50 rounded-md transition-colors;
}

/* ── Buy Me a Coffee (corner) ── */
.bmc-corner {
  @apply flex justify-end px-4 py-2;
  background: #fafaf9;
}
.bmc-link {
  @apply text-[11px] text-stone-300 hover:text-stone-500 transition-colors;
  text-decoration: none;
}
